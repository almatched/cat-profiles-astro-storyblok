---
import { storyblokEditable, useStoryblokApi } from "@storyblok/astro";
import { getTransLink } from "../utils/langs.js";

const { language, blok } = Astro.props;

const storyblokApi = useStoryblokApi();
const { data } = await storyblokApi.get(`cdn/stories`, {
  version: "draft", // or 'published'
  starts_with: "profiles/",
  is_startpage: 0,
  language,
});

const articles = data.stories;
---

<section {...storyblokEditable(blok)}>
  <ul role="list">
    {
      articles?.length &&
        articles.map((article) => {
          article.content.slug = article.slug;
          return (
            <li class="flex gap-3 mb-2">
              <div>
                <img
                  class="aspect-[4/3] object-cover max-w-80"
                  src={article.content.image.filename}
                />
              </div>
              <div>
                <h2>{article.content.name}</h2>
                {!!article.content.gender?.trim().length && (
                  <div class="mb-2">
                    <p class="font-bold">{article.content.gender_title}</p>
                    <p>{article.content.gender}</p>
                  </div>
                )}
                {!!article.content.birthdate?.trim().length &&
                  <div class="mb-2">
                    <p class="font-bold">{article.content.birthdate_title}</p>
                    <p>{article.content.birthdate.slice(0, 10)}</p>
                  </div>
                }
                {!!article.content.price?.trim().length &&
                  <div class="mb-2">
                    <p class="font-bold">{article.content.price_title}</p>
                    <p>{article.content.price}</p>
                  </div>
                }
                <a
                  href={getTransLink(
                    language,
                    `/profiles/${article.content.slug}`
                  )}
                >
                  read more...
                </a>
              </div>
            </li>
          );
        })
    }
  </ul>
</section>
